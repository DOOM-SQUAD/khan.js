(function(){var a,b=[].slice,c={}.hasOwnProperty,d=function(a,b){function d(){this.constructor=a}for(var e in b)c.call(b,e)&&(a[e]=b[e]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a};a={Deferred:jQuery.Deferred},"undefined"!=typeof window&&null!==window&&(window.Khan=a),a.Controller=function(){function c(){var a,c,d;a=arguments[0],d=2<=arguments.length?b.call(arguments,1):[],this.duration=a,c=_.map(d,function(a){return a.property}),this.tweens=_.object(c,d)}return c.requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame||function(a){return setTimeout(a,10)},c.prototype.update=function(a){var b,c,d,e;e=[];for(b in a)c=a[b],e.push(null!=(d=this.tweens[b])?d.end=c:void 0);return e},c.prototype.reset=function(){return delete this._deferred,delete this._ticks},c.prototype.stop=function(){return this.deferred().resolve()},c.prototype.promise=function(){return this.deferred().promise()},c.prototype.animate=function(){var b;return b=this.tick_all(),_.keys(b).length>0?(this.deferred().notify(b),a.Controller.requestAnimationFrame.call(window,this.animate.bind(this))):(b=this.tock_all(),this.deferred().notify(b),this.deferred().resolve(b)),this},c.prototype.deferred=function(){return this._deferred||(this._deferred=new a.Deferred)},c.prototype.tick_all=function(){return this._build(this.ticks(),function(a){return a.tick()})},c.prototype.tock_all=function(){return this._build(this.ticks(),function(a){return a.tock()})},c.prototype._build=function(a,b){var c,d,e,f;d={};for(c in a)f=a[c],e=b(f),null!==e&&(d[c]=e);return d},c.prototype.ticks=function(){var a,b,c;if(this._ticks)return this._ticks;this._ticks={},c=this.tweens;for(b in c)a=c[b],this._ticks[b]=a.tween(this.duration);return this._ticks},c}(),a.Ease=function(){function a(){}return a.linear=function(a,b,c,d){return c*(a/d)+b},a.circinout=function(a,b,c,d){return a/=d/2,1>a?-c/2*(Math.sqrt(1-a*a)-1)+b:(a-=2,c/2*(Math.sqrt(1-a*a)+1)+b)},a.quintout=function(a,b,c,d){return a/=d,a--,c*(a*a*a*a*a+1)+b},a}(),a.Tween=function(){function b(b,c,d,e,f){null==e&&(e="linear"),null==f&&(f={}),this.ease=a.Ease[e],this.properties.property=b,this.properties.start=c,this.properties.end=d,this.defineProperties(f)}return b.prototype.properties={},b.prototype.defineProperties=function(a){var b,c,d,e;d=this.properties,e=[];for(b in d)c=d[b],a.value=c,e.push(Object.defineProperty(this,b,this.defaultValues(a)));return e},b.prototype.defaultValues=function(a){var b;return null==a&&(a={}),b={configurable:!0,writable:!0,enumerable:!0},_.extend(b,a)},b.prototype.tween=function(b){return a.Utilities.tick(b,function(a){return function(c){return a.ease(c,a.start,a.end-a.start,b)}}(this))},b}(),a.Frames=function(b){function c(a,b,d,e){this.property=a,this.start=b,this.end=d,null==e&&(e="linear"),c.__super__.constructor.call(this,this.property,this.start,this.end,e),this.steps=Math.abs(this.start-this.end)}return d(c,b),c.prototype.tween=function(b){return a.Utilities.stretch(this.steps,b,function(a){return function(b){return Math.ceil(a.ease(b,a.start,a.end-a.start,a.steps))}}(this))},c}(a.Tween),a.Loop=function(){function b(a,b,c){this.property=a,this.steps=b,this.bounce=null!=c?c:!1}return b.prototype.tween=function(){return a.Utilities.loop(this.steps,this.bounce,function(){return function(a){return a}}(this))},b}(),a.Utilities=function(){function a(){}var b;return b=function(){return(new Date).getTime()},a.tick=function(a,c){return function(){var d;return d=b(),{tock:function(){return c(a)},tick:function(){var e;return e=b()-d,e>a?null:c(e)}}}()},a.step=function(a,b){return function(){var c;return c=0,{tock:function(){return b(a)},tick:function(){return c+=1,c>a?null:b(c)}}}()},a.stretch=function(a,c,d){return function(){var e,f,g;return f=b(),e=c/(a+1),g=0,{tock:function(){return d(a,c)},tick:function(){var c;return c=b()-f,g=Math.floor(c/e),g>a?null:d(g,c)}}}()},a.loop=function(a,b,c){return function(){var d,e,f,g;return"function"==typeof b&&(c=b,b=!1),g=0,e=function(a){return a+=1},f=function(a){return a-=1},d=e,{tock:function(){return c(a)},tick:function(){return d===e&&g>=a&&(b?d=f:g=0),d===f&&1>=g&&(d=e),g=d(g),c(g)}}}()},a}()}).call(this);