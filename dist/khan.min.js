(function(){var a=[].slice,b={}.hasOwnProperty,c=function(a,c){function d(){this.constructor=a}for(var e in c)b.call(c,e)&&(a[e]=c[e]);return d.prototype=c.prototype,a.prototype=new d,a.__super__=c.prototype,a};"undefined"!=typeof window&&null!==window&&(window.Khan={Deferred:jQuery.Deferred}),Khan.Controller=function(){function b(){var b,c,d;b=arguments[0],d=2<=arguments.length?a.call(arguments,1):[],this.duration=b,c=_.map(d,function(a){return a.property}),this.tweens=_.object(c,d)}return b.requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame||function(a){return setTimeout(a,10)},b.prototype.update=function(a){var b,c,d,e;e=[];for(b in a)c=a[b],e.push(null!=(d=this.tweens[b])?d.end=c:void 0);return e},b.prototype.reset=function(){return delete this._deferred,delete this._ticks},b.prototype.stop=function(){return this.deferred().resolve()},b.prototype.promise=function(){return this.deferred().promise()},b.prototype.animate=function(){var a;return a=this.tick_all(),_.keys(a).length>0?(this.deferred().notify(a),Khan.Controller.requestAnimationFrame.call(window,this.animate.bind(this))):(a=this.tock_all(),this.deferred().notify(a),this.deferred().resolve(a)),this},b.prototype.deferred=function(){return this._deferred||(this._deferred=new Khan.Deferred)},b.prototype.tick_all=function(){return this._build(this.ticks(),function(a){return a.tick()})},b.prototype.tock_all=function(){return this._build(this.ticks(),function(a){return a.tock()})},b.prototype._build=function(a,b){var c,d,e,f;d={};for(c in a)f=a[c],e=b(f),null!==e&&(d[c]=e);return d},b.prototype.ticks=function(){var a,b,c;if(this._ticks)return this._ticks;this._ticks={},c=this.tweens;for(b in c)a=c[b],this._ticks[b]=a.tween(this.duration);return this._ticks},b}(),Khan.Ease=function(){function a(){}return a.linear=function(a,b,c,d){return c*(a/d)+b},a.circinout=function(a,b,c,d){return a/=d/2,1>a?-c/2*(Math.sqrt(1-a*a)-1)+b:(a-=2,c/2*(Math.sqrt(1-a*a)+1)+b)},a.quintout=function(a,b,c,d){return a/=d,a--,c*(a*a*a*a*a+1)+b},a}(),Khan.Tween=function(){function a(a,b,c,d,e){null==d&&(d="linear"),null==e&&(e={}),this.ease=Khan.Ease[d],this.properties.property=a,this.properties.start=b,this.properties.end=c,this.defineProperties(e)}return a.prototype.properties={},a.prototype.defineProperties=function(a){var b,c,d,e;d=this.properties,e=[];for(b in d)c=d[b],a.value=c,e.push(Object.defineProperty(this,b,this.defaultValues(a)));return e},a.prototype.defaultValues=function(a){var b;return null==a&&(a={}),b={configurable:!0,writable:!0,enumerable:!0},a.updatable===!1&&_.extend(b,{writable:!1,configurable:!1}),_.extend(b,a)},a.prototype.tween=function(a){return Khan.Utilities.tick(a,function(b){return function(c){return b.ease(c,b.start,b.end-b.start,a)}}(this))},a}(),Khan.Frames=function(a){function b(a,c,d,e){this.property=a,this.start=c,this.end=d,null==e&&(e="linear"),b.__super__.constructor.call(this,this.property,this.start,this.end,e),this.steps=this.start===this.end?1:Math.abs(this.start-this.end)}return c(b,a),b.prototype.tween=function(a){return Khan.Utilities.stretch(this.steps,a,function(a){return function(b){return Math.round(a.ease(b,a.start,a.end-a.start,a.steps))}}(this))},b}(Khan.Tween),Khan.Range=function(a){function b(a,c,d,e){this.property=a,this.start=c,this.end=d,this.steps=e,b.__super__.constructor.call(this,this.property,this.start,this.end),this.diff=Math.abs(this.start-this.end)+1,this.direction=1,null==this.steps&&(this.steps=this.start===this.end?1:this.diff),this.start>this.end?this.direction=-1:this.start===this.end&&(this.direction=0)}return c(b,a),b.prototype.tween=function(){return Khan.Utilities.step(this.steps,function(a){return function(b){return a.steps>a.diff&&(b=b*a.diff/a.steps),1===a.steps?a.end:Math.round(a.start+b*a.direction)}}(this))},b}(Khan.Tween),Khan.Loop=function(){function a(a,b,c){this.property=a,this.steps=b,this.bounce=null!=c?c:!1}return a.prototype.tween=function(){return Khan.Utilities.loop(this.steps,this.bounce,function(){return function(a){return a}}(this))},a}(),Khan.Utilities=function(){function a(){}var b;return b=function(){return(new Date).getTime()},a.tick=function(a,c){return function(){var d;return d=b(),{tock:function(){return c(a)},tick:function(){var e;return e=b()-d,e>a?null:c(e)}}}()},a.step=function(a,b){return function(){var c;return c=0,{tock:function(){return b(a)},tick:function(){return c+=1,c>a?null:b(c)}}}()},a.stretch=function(a,c,d){return function(){var e,f,g;return f=b(),e=c/(a+1),g=0,{tock:function(){return d(a,c)},tick:function(){var c;return c=b()-f,g=Math.floor(c/e),g>a?null:d(g,c)}}}()},a.loop=function(a,b,c){return function(){var d,e,f,g;return"function"==typeof b&&(c=b,b=!1),g=0,e=function(a){return a+=1},f=function(a){return a-=1},d=e,{tock:function(){return c(a)},tick:function(){return d===e&&g>=a&&(b?d=f:g=0),d===f&&1>=g&&(d=e),g=d(g),c(g)}}}()},a}()}).call(this);